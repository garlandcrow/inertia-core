{"version":3,"file":"index.module.js","sources":["../src/modal.ts","../src/types.ts","../src/debounce.ts","../src/formData.ts","../src/url.ts","../src/events.ts","../src/router.ts","../src/files.ts","../src/head.ts","../src/shouldIntercept.ts","../src/index.ts"],"sourcesContent":["export default {\n  modal: null,\n  listener: null,\n\n  show(html: Record<string, unknown>|string): void {\n    if (typeof html === 'object') {\n      html = `All Inertia requests must receive a valid Inertia response, however a plain JSON response was received.<hr>${JSON.stringify(html)}`\n    }\n\n    const page = document.createElement('html')\n    page.innerHTML = html\n    page.querySelectorAll('a').forEach(a => a.setAttribute('target', '_top'))\n\n    this.modal = document.createElement('div')\n    this.modal.style.position = 'fixed'\n    this.modal.style.width = '100vw'\n    this.modal.style.height = '100vh'\n    this.modal.style.padding = '50px'\n    this.modal.style.boxSizing = 'border-box'\n    this.modal.style.backgroundColor = 'rgba(0, 0, 0, .6)'\n    this.modal.style.zIndex = 200000\n    this.modal.addEventListener('click', () => this.hide())\n\n    const iframe = document.createElement('iframe')\n    iframe.style.backgroundColor = 'white'\n    iframe.style.borderRadius = '5px'\n    iframe.style.width = '100%'\n    iframe.style.height = '100%'\n    this.modal.appendChild(iframe)\n\n    document.body.prepend(this.modal)\n    document.body.style.overflow = 'hidden'\n    if (!iframe.contentWindow) {\n      throw new Error('iframe not yet ready.')\n    }\n    iframe.contentWindow.document.open()\n    iframe.contentWindow.document.write(page.outerHTML)\n    iframe.contentWindow.document.close()\n\n    this.listener = this.hideOnEscape.bind(this)\n    document.addEventListener('keydown', this.listener)\n  },\n\n  hide(): void {\n    this.modal.outerHTML = ''\n    this.modal = null\n    document.body.style.overflow = 'visible'\n    document.removeEventListener('keydown', this.listener)\n  },\n\n  hideOnEscape(event: KeyboardEvent): void {\n    if (event.keyCode === 27) {\n      this.hide()\n    }\n  },\n}\n","import { AxiosResponse, CancelTokenSource } from 'axios'\n\nexport type Errors = Record<string, string>\nexport type ErrorBag = Record<string, Errors>\n\nexport type FormDataConvertible = Array<FormDataConvertible>|Blob|FormDataEntryValue|Date|boolean|number|null\n\nexport enum Method {\n  GET = 'get',\n  POST = 'post',\n  PUT = 'put',\n  PATCH = 'patch',\n  DELETE = 'delete',\n}\n\nexport type RequestPayload = Record<string, FormDataConvertible>|FormData\n\nexport interface PageProps {\n  [key: string]: unknown\n}\n\nexport interface Page<SharedProps = PageProps> {\n  component: string,\n  props: PageProps & SharedProps & {\n    errors: Errors & ErrorBag;\n  }\n  url: string,\n  version: string|null\n\n  // Refactor away\n  scrollRegions: Array<{ top: number, left: number }>\n  rememberedState: Record<string, unknown>\n  resolvedErrors: Errors\n}\n\nexport type PageResolver = (name: string) => Component\n\nexport type PageHandler = ({\n  component,\n  page,\n  preserveState,\n}: {\n  component: Component,\n  page: Page,\n  preserveState: PreserveStateOption,\n}) => Promise<unknown>\n\nexport type PreserveStateOption = boolean|string|((page: Page) => boolean)\n\nexport type LocationVisit = {\n  preserveScroll: boolean,\n}\n\nexport type Visit = {\n  method: Method,\n  data: RequestPayload,\n  replace: boolean,\n  preserveScroll: PreserveStateOption,\n  preserveState: PreserveStateOption,\n  only: Array<string>,\n  headers: Record<string, string>\n  errorBag: string|null,\n  forceFormData: boolean,\n}\n\nexport type GlobalEventsMap = {\n  before: {\n    parameters: [PendingVisit],\n    details: {\n      visit: PendingVisit,\n    },\n    result: boolean|void,\n  },\n  start: {\n    parameters: [PendingVisit],\n    details: {\n      visit: PendingVisit,\n    },\n    result: void,\n  },\n  progress: {\n    parameters: [{ percentage: number }|undefined],\n    details: {\n      progress: { percentage: number }|undefined,\n    },\n    result: void,\n  },\n  finish: {\n    parameters: [ActiveVisit],\n    details: {\n      visit: ActiveVisit,\n    },\n    result: void,\n  },\n  cancel: {\n    parameters: [],\n    details: {\n    },\n    result: void,\n  },\n  navigate: {\n    parameters: [Page],\n    details: {\n        page: Page\n    },\n    result: void,\n  },\n  success: {\n    parameters: [Page],\n    details: {\n        page: Page\n    },\n    result: void,\n  },\n  error: {\n    parameters: [Errors],\n    details: {\n        errors: Errors\n    },\n    result: void,\n  },\n  invalid: {\n    parameters: [AxiosResponse],\n    details: {\n        response: AxiosResponse\n    },\n    result: boolean,\n  },\n  exception: {\n    parameters: [Error],\n    details: {\n        exception: Error\n    },\n    result: boolean,\n  },\n}\n\nexport type GlobalEventNames = keyof GlobalEventsMap\n\nexport type GlobalEvent<TEventName extends GlobalEventNames> = CustomEvent<GlobalEventDetails<TEventName>>\n\nexport type GlobalEventParameters<TEventName extends GlobalEventNames> = GlobalEventsMap[TEventName]['parameters']\n\nexport type GlobalEventResult<TEventName extends GlobalEventNames> = GlobalEventsMap[TEventName]['result']\n\nexport type GlobalEventDetails<TEventName extends GlobalEventNames> = GlobalEventsMap[TEventName]['details']\n\nexport type GlobalEventTrigger<TEventName extends GlobalEventNames> = (...params: GlobalEventParameters<TEventName>) => GlobalEventResult<TEventName>\n\nexport type GlobalEventCallback<TEventName extends GlobalEventNames> = (...params: GlobalEventParameters<TEventName>) => GlobalEventResult<TEventName>\n\nexport type VisitOptions = Partial<Visit & {\n  onCancelToken: { ({ cancel }: { cancel: VoidFunction }): void },\n  onBefore: GlobalEventCallback<'before'>,\n  onStart: GlobalEventCallback<'start'>,\n  onProgress: GlobalEventCallback<'progress'>,\n  onFinish: GlobalEventCallback<'finish'>,\n  onCancel: GlobalEventCallback<'cancel'>,\n  onSuccess: GlobalEventCallback<'success'>,\n  onError: GlobalEventCallback<'error'>,\n}>\n\nexport type PendingVisit = Visit & {\n  url: URL,\n  completed: boolean,\n  cancelled: boolean,\n  interrupted: boolean,\n};\n\nexport type ActiveVisit = PendingVisit & Required<VisitOptions> & {\n  cancelToken: CancelTokenSource,\n}\n\nexport type VisitId = unknown\nexport type Component = unknown\n","// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default function debounce<F extends (...params: any[]) => ReturnType<F>>(fn: F, delay: number): F {\n  let timeoutID: NodeJS.Timeout\n  return function (...args: unknown[]) {\n    clearTimeout(timeoutID)\n    timeoutID = setTimeout(() => fn.apply(this, args), delay)\n  } as F\n}\n","import { FormDataConvertible } from './types'\n\nexport function objectToFormData(\n  source: Record<string, FormDataConvertible>,\n  form: FormData = new FormData(),\n  parentKey: string|null = null,\n): FormData {\n  source = source || {}\n\n  for (const key in source) {\n    if (Object.prototype.hasOwnProperty.call(source, key)) {\n      append(form, composeKey(parentKey, key), source[key])\n    }\n  }\n\n  return form\n}\n\nfunction composeKey(parent: string|null, key: string): string {\n  return parent ? parent + '[' + key + ']' : key\n}\n\nfunction append(form: FormData, key: string, value: FormDataConvertible): void {\n  if (Array.isArray(value)) {\n    return Array.from(value.keys()).forEach(index => append(form, composeKey(key, index.toString()), value[index]))\n  } else if (value instanceof Date) {\n    return form.append(key, value.toISOString())\n  } else if (value instanceof File) {\n    return form.append(key, value, value.name)\n  } else if (value instanceof Blob) {\n    return form.append(key, value)\n  } else if (typeof value === 'boolean') {\n    return form.append(key, value ? '1' : '0')\n  } else if (typeof value === 'string') {\n    return form.append(key, value)\n  } else if (typeof value === 'number') {\n    return form.append(key, `${value}`)\n  } else if (value === null || value === undefined) {\n    return form.append(key, '')\n  }\n\n  objectToFormData(value, form, key)\n}\n","import * as qs from 'qs'\nimport deepmerge from 'deepmerge'\nimport { FormDataConvertible, Method } from './types'\n\nexport function hrefToUrl(href: string|URL): URL {\n  return new URL(href.toString(), window.location.toString())\n}\n\nexport function mergeDataIntoQueryString(\n  method: Method,\n  href: URL|string,\n  data: Record<string, FormDataConvertible>,\n): [string, Record<string, FormDataConvertible>] {\n  const hasHost = href.toString().includes('http')\n  const hasAbsolutePath = hasHost || href.toString().startsWith('/')\n  const hasRelativePath = !hasAbsolutePath && !href.toString().startsWith('#') && !href.toString().startsWith('?')\n  const hasSearch = href.toString().includes('?') || (method === Method.GET && Object.keys(data).length)\n  const hasHash = href.toString().includes('#')\n\n  const url = new URL(href.toString(), 'http://localhost')\n\n  if (method === Method.GET && Object.keys(data).length) {\n    url.search = qs.stringify(deepmerge(qs.parse(url.search, { ignoreQueryPrefix: true }), data), {\n      encodeValuesOnly: true,\n      arrayFormat: 'brackets',\n    })\n    data = {}\n  }\n\n  return [\n    [\n      hasHost ? `${url.protocol}//${url.host}` : '',\n      hasAbsolutePath ? url.pathname : '',\n      hasRelativePath ? url.pathname.substring(1) : '',\n      hasSearch ? url.search : '',\n      hasHash ? url.hash : '',\n    ].join(''),\n    data,\n  ]\n}\n\nexport function urlWithoutHash(url: URL|Location): URL {\n  url = new URL(url.href)\n  url.hash = ''\n  return url\n}\n","import { GlobalEventDetails, GlobalEventNames, GlobalEventTrigger } from './types'\n\nfunction fireEvent<TEventName extends GlobalEventNames>(name: TEventName, options: CustomEventInit<GlobalEventDetails<TEventName>>): boolean {\n  return document.dispatchEvent(new CustomEvent(`inertia:${name}`, options))\n}\n\nexport const fireBeforeEvent: GlobalEventTrigger<'before'> = (visit) => {\n  return fireEvent('before', { cancelable: true, detail: { visit } })\n}\n\nexport const fireErrorEvent: GlobalEventTrigger<'error'> = (errors) => {\n  return fireEvent('error', { detail: { errors } })\n}\n\nexport const fireExceptionEvent: GlobalEventTrigger<'exception'> = (exception) => {\n  return fireEvent('exception', { cancelable: true, detail: { exception } })\n}\n\nexport const fireFinishEvent: GlobalEventTrigger<'finish'> = (visit) => {\n  return fireEvent('finish', { detail: { visit } })\n}\n\nexport const fireInvalidEvent: GlobalEventTrigger<'invalid'> = (response) => {\n  return fireEvent('invalid', { cancelable: true, detail: { response } })\n}\n\nexport const fireNavigateEvent: GlobalEventTrigger<'navigate'> = (page) => {\n  return fireEvent('navigate', { detail: { page } })\n}\n\nexport const fireProgressEvent: GlobalEventTrigger<'progress'> = (progress) => {\n  return fireEvent('progress', { detail: { progress } })\n}\n\nexport const fireStartEvent: GlobalEventTrigger<'start'> = (visit) => {\n  return fireEvent('start', { detail: { visit } })\n}\n\nexport const fireSuccessEvent: GlobalEventTrigger<'success'> = (page) => {\n  return fireEvent('success', { detail: { page } })\n}\n","import modal from \"./modal\";\nimport debounce from \"./debounce\";\nimport { hasFiles } from \"./files\";\nimport { objectToFormData } from \"./formData\";\nimport { default as Axios, AxiosResponse } from \"axios\";\nimport { hrefToUrl, mergeDataIntoQueryString, urlWithoutHash } from \"./url\";\nimport {\n  ActiveVisit,\n  GlobalEvent,\n  GlobalEventNames,\n  GlobalEventResult,\n  LocationVisit,\n  Method,\n  Page,\n  PageHandler,\n  PageResolver,\n  PendingVisit,\n  PreserveStateOption,\n  RequestPayload,\n  VisitId,\n  VisitOptions,\n} from \"./types\";\nimport {\n  fireBeforeEvent,\n  fireErrorEvent,\n  fireExceptionEvent,\n  fireFinishEvent,\n  fireInvalidEvent,\n  fireNavigateEvent,\n  fireProgressEvent,\n  fireStartEvent,\n  fireSuccessEvent,\n} from \"./events\";\n\nAxios.defaults.xsrfHeaderName = \"x-csrf-token\";\nexport class Router {\n  protected resolveComponent!: PageResolver;\n  protected swapComponent!: PageHandler;\n  protected activeVisit?: ActiveVisit;\n  protected visitId: VisitId = null;\n  protected page!: Page;\n\n  public init({\n    initialPage,\n    resolveComponent,\n    swapComponent,\n  }: {\n    initialPage: Page;\n    resolveComponent: PageResolver;\n    swapComponent: PageHandler;\n  }): void {\n    this.page = initialPage;\n    this.resolveComponent = resolveComponent;\n    this.swapComponent = swapComponent;\n    this.handleInitialPageVisit();\n    this.setupEventListeners();\n  }\n\n  protected handleInitialPageVisit(): void {\n    if (this.isBackForwardVisit()) {\n      this.handleBackForwardVisit(this.page);\n    } else if (this.isLocationVisit()) {\n      this.handleLocationVisit(this.page);\n    } else {\n      this.page.url += window.location.hash;\n      this.setPage(this.page, { preserveState: true });\n    }\n    fireNavigateEvent(this.page);\n  }\n\n  protected setupEventListeners(): void {\n    window.addEventListener(\"popstate\", this.handlePopstateEvent.bind(this));\n    document.addEventListener(\n      \"scroll\",\n      debounce(this.handleScrollEvent.bind(this), 100),\n      true\n    );\n  }\n\n  protected scrollRegions(): NodeListOf<Element> {\n    return document.querySelectorAll(\"[scroll-region]\");\n  }\n\n  protected handleScrollEvent(event: Event): void {\n    if (\n      typeof (event.target as Element).hasAttribute === \"function\" &&\n      (event.target as Element).hasAttribute(\"scroll-region\")\n    ) {\n      this.saveScrollPositions();\n    }\n  }\n\n  protected saveScrollPositions(): void {\n    this.replaceState({\n      ...this.page,\n      scrollRegions: Array.from(this.scrollRegions()).map((region) => {\n        return {\n          top: region.scrollTop,\n          left: region.scrollLeft,\n        };\n      }),\n    });\n  }\n\n  protected resetScrollPositions(): void {\n    document.documentElement.scrollTop = 0;\n    document.documentElement.scrollLeft = 0;\n    this.scrollRegions().forEach((region) => {\n      region.scrollTop = 0;\n      region.scrollLeft = 0;\n    });\n    this.saveScrollPositions();\n    if (window.location.hash) {\n      document.getElementById(window.location.hash.slice(1))?.scrollIntoView();\n    }\n  }\n\n  protected restoreScrollPositions(): void {\n    if (this.page.scrollRegions) {\n      this.scrollRegions().forEach((region: Element, index: number) => {\n        region.scrollTop = this.page.scrollRegions[index].top;\n        region.scrollLeft = this.page.scrollRegions[index].left;\n      });\n    }\n  }\n\n  protected isBackForwardVisit(): boolean {\n    return (\n      window.history.state &&\n      window.performance &&\n      window.performance.getEntriesByType(\"navigation\").length > 0 &&\n      (\n        window.performance.getEntriesByType(\n          \"navigation\"\n        )[0] as PerformanceNavigationTiming\n      ).type === \"back_forward\"\n    );\n  }\n\n  protected handleBackForwardVisit(page: Page): void {\n    window.history.state.version = page.version;\n    this.setPage(window.history.state, {\n      preserveScroll: true,\n      preserveState: true,\n    }).then(() => {\n      this.restoreScrollPositions();\n    });\n  }\n\n  protected locationVisit(\n    url: URL,\n    preserveScroll: LocationVisit[\"preserveScroll\"]\n  ): boolean | void {\n    try {\n      const locationVisit: LocationVisit = { preserveScroll };\n      window.sessionStorage.setItem(\n        \"inertiaLocationVisit\",\n        JSON.stringify(locationVisit)\n      );\n      window.location.href = url.href;\n      if (urlWithoutHash(window.location).href === urlWithoutHash(url).href) {\n        window.location.reload();\n      }\n    } catch (error) {\n      return false;\n    }\n  }\n\n  protected isLocationVisit(): boolean {\n    try {\n      return window.sessionStorage.getItem(\"inertiaLocationVisit\") !== null;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  protected handleLocationVisit(page: Page): void {\n    const locationVisit: LocationVisit = JSON.parse(\n      window.sessionStorage.getItem(\"inertiaLocationVisit\") || \"\"\n    );\n    window.sessionStorage.removeItem(\"inertiaLocationVisit\");\n    page.url += window.location.hash;\n    page.rememberedState = window.history.state?.rememberedState ?? {};\n    page.scrollRegions = window.history.state?.scrollRegions ?? [];\n    this.setPage(page, {\n      preserveScroll: locationVisit.preserveScroll,\n      preserveState: true,\n    }).then(() => {\n      if (locationVisit.preserveScroll) {\n        this.restoreScrollPositions();\n      }\n    });\n  }\n\n  protected isLocationVisitResponse(response: AxiosResponse): boolean {\n    return (\n      response &&\n      response.status === 409 &&\n      response.headers[\"x-inertia-location\"]\n    );\n  }\n\n  protected isInertiaResponse(response: AxiosResponse): boolean {\n    return response?.headers[\"x-inertia\"];\n  }\n\n  protected createVisitId(): VisitId {\n    this.visitId = {};\n    return this.visitId;\n  }\n\n  protected cancelVisit(\n    activeVisit: ActiveVisit,\n    {\n      cancelled = false,\n      interrupted = false,\n    }: { cancelled?: boolean; interrupted?: boolean }\n  ): void {\n    if (\n      activeVisit &&\n      !activeVisit.completed &&\n      !activeVisit.cancelled &&\n      !activeVisit.interrupted\n    ) {\n      activeVisit.cancelToken.cancel();\n      activeVisit.onCancel();\n      activeVisit.completed = false;\n      activeVisit.cancelled = cancelled;\n      activeVisit.interrupted = interrupted;\n      fireFinishEvent(activeVisit);\n      activeVisit.onFinish(activeVisit);\n    }\n  }\n\n  protected finishVisit(visit: ActiveVisit): void {\n    if (!visit.cancelled && !visit.interrupted) {\n      visit.completed = true;\n      visit.cancelled = false;\n      visit.interrupted = false;\n      fireFinishEvent(visit);\n      visit.onFinish(visit);\n    }\n  }\n\n  protected resolvePreserveOption(\n    value: PreserveStateOption,\n    page: Page\n  ): boolean | string {\n    if (typeof value === \"function\") {\n      return value(page);\n    } else if (value === \"errors\") {\n      return Object.keys(page.props.errors || {}).length > 0;\n    } else {\n      return value;\n    }\n  }\n\n  public visit(\n    href: string | URL,\n    {\n      method = Method.GET,\n      data = {},\n      replace = false,\n      preserveScroll = false,\n      preserveState = false,\n      only = [],\n      headers = {},\n      errorBag = \"\",\n      forceFormData = false,\n      onCancelToken = () => {},\n      onBefore = () => {},\n      onStart = () => {},\n      onProgress = () => {},\n      onFinish = () => {},\n      onCancel = () => {},\n      onSuccess = () => {},\n      onError = () => {},\n    }: VisitOptions = {}\n  ): void {\n    let url = typeof href === \"string\" ? hrefToUrl(href) : href;\n\n    if ((hasFiles(data) || forceFormData) && !(data instanceof FormData)) {\n      data = objectToFormData(data);\n    }\n\n    if (!(data instanceof FormData)) {\n      const [_href, _data] = mergeDataIntoQueryString(method, url, data);\n      url = hrefToUrl(_href);\n      data = _data;\n    }\n\n    const visit: PendingVisit = {\n      url,\n      method,\n      data,\n      replace,\n      preserveScroll,\n      preserveState,\n      only,\n      headers,\n      errorBag,\n      forceFormData,\n      cancelled: false,\n      completed: false,\n      interrupted: false,\n    };\n\n    if (onBefore(visit) === false || !fireBeforeEvent(visit)) {\n      return;\n    }\n\n    if (this.activeVisit) {\n      this.cancelVisit(this.activeVisit, { interrupted: true });\n    }\n\n    this.saveScrollPositions();\n\n    const visitId = this.createVisitId();\n    this.activeVisit = {\n      ...visit,\n      onCancelToken,\n      onBefore,\n      onStart,\n      onProgress,\n      onFinish,\n      onCancel,\n      onSuccess,\n      onError,\n      cancelToken: Axios.CancelToken.source(),\n    };\n\n    onCancelToken({\n      cancel: () => {\n        if (this.activeVisit) {\n          this.cancelVisit(this.activeVisit, { cancelled: true });\n        }\n      },\n    });\n\n    fireStartEvent(visit);\n    onStart(visit);\n\n    Axios({\n      method,\n      url: urlWithoutHash(url).href,\n      data: method === Method.GET ? {} : data,\n      params: method === Method.GET ? data : {},\n      cancelToken: this.activeVisit.cancelToken.token,\n      headers: {\n        ...headers,\n        Accept: \"text/html, application/xhtml+xml\",\n        \"X-Requested-With\": \"XMLHttpRequest\",\n        \"X-Inertia\": true,\n        ...(only.length\n          ? {\n              \"X-Inertia-Partial-Component\": this.page.component,\n              \"X-Inertia-Partial-Data\": only.join(\",\"),\n            }\n          : {}),\n        ...(errorBag && errorBag.length\n          ? { \"X-Inertia-Error-Bag\": errorBag }\n          : {}),\n        ...(this.page.version\n          ? { \"X-Inertia-Version\": this.page.version }\n          : {}),\n      },\n      onUploadProgress: (progress) => {\n        if (data instanceof FormData) {\n          progress.percentage = Math.round(\n            (progress.loaded / progress.total) * 100\n          );\n          fireProgressEvent(progress);\n          onProgress(progress);\n        }\n      },\n    })\n      .then((response) => {\n        if (!this.isInertiaResponse(response)) {\n          return Promise.reject({ response });\n        }\n\n        const pageResponse: Page = response.data;\n        if (only.length && pageResponse.component === this.page.component) {\n          pageResponse.props = { ...this.page.props, ...pageResponse.props };\n        }\n        preserveScroll = this.resolvePreserveOption(\n          preserveScroll,\n          pageResponse\n        ) as boolean;\n        preserveState = this.resolvePreserveOption(preserveState, pageResponse);\n        if (\n          preserveState &&\n          window.history.state?.rememberedState &&\n          pageResponse.component === this.page.component\n        ) {\n          pageResponse.rememberedState = window.history.state.rememberedState;\n        }\n        const requestUrl = url;\n        const responseUrl = hrefToUrl(pageResponse.url);\n        if (\n          requestUrl.hash &&\n          !responseUrl.hash &&\n          urlWithoutHash(requestUrl).href === responseUrl.href\n        ) {\n          responseUrl.hash = requestUrl.hash;\n          pageResponse.url = responseUrl.href;\n        }\n        return this.setPage(pageResponse, {\n          visitId,\n          replace,\n          preserveScroll,\n          preserveState,\n        });\n      })\n      .then(() => {\n        const errors = this.page.props.errors || {};\n        if (Object.keys(errors).length > 0) {\n          const scopedErrors = errorBag\n            ? errors[errorBag]\n              ? errors[errorBag]\n              : {}\n            : errors;\n          fireErrorEvent(scopedErrors);\n          return onError(scopedErrors);\n        }\n        fireSuccessEvent(this.page);\n        return onSuccess(this.page);\n      })\n      .catch((error) => {\n        if (this.isInertiaResponse(error.response)) {\n          return this.setPage(error.response.data, { visitId });\n        } else if (this.isLocationVisitResponse(error.response)) {\n          const locationUrl = hrefToUrl(\n            error.response.headers[\"x-inertia-location\"]\n          );\n          const requestUrl = url;\n          if (\n            requestUrl.hash &&\n            !locationUrl.hash &&\n            urlWithoutHash(requestUrl).href === locationUrl.href\n          ) {\n            locationUrl.hash = requestUrl.hash;\n          }\n          this.locationVisit(locationUrl, preserveScroll === true);\n        } else if (error.response) {\n          if (fireInvalidEvent(error.response)) {\n            modal.show(error.response.data);\n          }\n        } else {\n          return Promise.reject(error);\n        }\n      })\n      .then(() => {\n        if (this.activeVisit) {\n          this.finishVisit(this.activeVisit);\n        }\n      })\n      .catch((error) => {\n        if (!Axios.isCancel(error)) {\n          const throwException = fireExceptionEvent(error);\n          if (this.activeVisit) {\n            this.finishVisit(this.activeVisit);\n          }\n          if (throwException) {\n            return Promise.reject(error);\n          }\n        }\n      });\n  }\n\n  protected setPage(\n    page: Page,\n    {\n      visitId = this.createVisitId(),\n      replace = false,\n      preserveScroll = false,\n      preserveState = false,\n    }: {\n      visitId?: VisitId;\n      replace?: boolean;\n      preserveScroll?: PreserveStateOption;\n      preserveState?: PreserveStateOption;\n    } = {}\n  ): Promise<void> {\n    return Promise.resolve(this.resolveComponent(page.component)).then(\n      (component) => {\n        if (visitId === this.visitId) {\n          page.scrollRegions = page.scrollRegions || [];\n          page.rememberedState = page.rememberedState || {};\n          replace =\n            replace || hrefToUrl(page.url).href === window.location.href;\n          replace ? this.replaceState(page) : this.pushState(page);\n          this.swapComponent({ component, page, preserveState }).then(() => {\n            if (!preserveScroll) {\n              this.resetScrollPositions();\n            }\n            if (!replace) {\n              fireNavigateEvent(page);\n            }\n          });\n        }\n      }\n    );\n  }\n\n  protected pushState(page: Page): void {\n    this.page = page;\n    window.history.pushState(page, \"\", page.url);\n  }\n\n  protected replaceState(page: Page): void {\n    this.page = page;\n    window.history.replaceState(page, \"\", page.url);\n  }\n\n  protected handlePopstateEvent(event: PopStateEvent): void {\n    if (event.state !== null) {\n      const page = event.state;\n      const visitId = this.createVisitId();\n      Promise.resolve(this.resolveComponent(page.component)).then(\n        (component) => {\n          if (visitId === this.visitId) {\n            this.page = page;\n            this.swapComponent({ component, page, preserveState: false }).then(\n              () => {\n                this.restoreScrollPositions();\n                fireNavigateEvent(page);\n              }\n            );\n          }\n        }\n      );\n    } else {\n      const url = hrefToUrl(this.page.url);\n      url.hash = window.location.hash;\n      this.replaceState({ ...this.page, url: url.href });\n      this.resetScrollPositions();\n    }\n  }\n\n  public get(\n    url: URL | string,\n    data: RequestPayload = {},\n    options: Exclude<VisitOptions, \"method\" | \"data\"> = {}\n  ): void {\n    return this.visit(url, { ...options, method: Method.GET, data });\n  }\n\n  public reload(\n    options: Exclude<VisitOptions, \"preserveScroll\" | \"preserveState\"> = {}\n  ): void {\n    return this.visit(window.location.href, {\n      ...options,\n      preserveScroll: true,\n      preserveState: true,\n    });\n  }\n\n  public replace(\n    url: URL | string,\n    options: Exclude<VisitOptions, \"replace\"> = {}\n  ): void {\n    console.warn(\n      `Inertia.replace() has been deprecated and will be removed in a future release. Please use Inertia.${\n        options.method ?? \"get\"\n      }() instead.`\n    );\n    return this.visit(url, { preserveState: true, ...options, replace: true });\n  }\n\n  public post(\n    url: URL | string,\n    data: RequestPayload = {},\n    options: Exclude<VisitOptions, \"method\" | \"data\"> = {}\n  ): void {\n    return this.visit(url, {\n      preserveState: true,\n      ...options,\n      method: Method.POST,\n      data,\n    });\n  }\n\n  public put(\n    url: URL | string,\n    data: RequestPayload = {},\n    options: Exclude<VisitOptions, \"method\" | \"data\"> = {}\n  ): void {\n    return this.visit(url, {\n      preserveState: true,\n      ...options,\n      method: Method.PUT,\n      data,\n    });\n  }\n\n  public patch(\n    url: URL | string,\n    data: RequestPayload = {},\n    options: Exclude<VisitOptions, \"method\" | \"data\"> = {}\n  ): void {\n    return this.visit(url, {\n      preserveState: true,\n      ...options,\n      method: Method.PATCH,\n      data,\n    });\n  }\n\n  public delete(\n    url: URL | string,\n    options: Exclude<VisitOptions, \"method\"> = {}\n  ): void {\n    return this.visit(url, {\n      preserveState: true,\n      ...options,\n      method: Method.DELETE,\n    });\n  }\n\n  public remember(data: unknown, key = \"default\"): void {\n    this.replaceState({\n      ...this.page,\n      rememberedState: {\n        ...this.page.rememberedState,\n        [key]: data,\n      },\n    });\n  }\n\n  public restore(key = \"default\"): unknown {\n    return window.history.state?.rememberedState?.[key];\n  }\n\n  public on<TEventName extends GlobalEventNames>(\n    type: TEventName,\n    callback: (event: GlobalEvent<TEventName>) => GlobalEventResult<TEventName>\n  ): VoidFunction {\n    const listener = ((event: GlobalEvent<TEventName>) => {\n      const response = callback(event);\n      if (event.cancelable && !event.defaultPrevented && response === false) {\n        event.preventDefault();\n      }\n    }) as EventListener;\n\n    document.addEventListener(`inertia:${type}`, listener);\n    return () => document.removeEventListener(`inertia:${type}`, listener);\n  }\n}\n","import { FormDataConvertible, RequestPayload } from './types'\n\nexport function hasFiles(data: RequestPayload|FormDataConvertible): boolean {\n  return (\n    data instanceof File ||\n    data instanceof Blob ||\n    (data instanceof FileList && data.length > 0) ||\n    (data instanceof FormData && Array.from(data.values()).some((value) => hasFiles(value))) ||\n    (typeof data === 'object' && data !== null && Object.values(data).some((value) => hasFiles(value)))\n  )\n}\n","import debounce from './debounce'\n\nconst Renderer = {\n  buildDOMElement(tag: string): ChildNode {\n    const template = document.createElement('template')\n    template.innerHTML = tag\n    const node = (template.content.firstChild as Element)\n\n    if (!tag.startsWith('<script ')) {\n      return node\n    }\n\n    const script = document.createElement('script')\n    script.innerHTML = node.innerHTML\n    node.getAttributeNames().forEach(name => {\n      script.setAttribute(name, node.getAttribute(name) || '')\n    })\n\n    return script\n  },\n\n  isInertiaManagedElement(element: Element): boolean {\n    return element.nodeType === Node.ELEMENT_NODE && element.getAttribute('inertia') !== null\n  },\n\n  findMatchingElementIndex(element: Element, elements: Array<Element>): number {\n    const key = element.getAttribute('inertia')\n    if (key !== null) {\n      return elements.findIndex(element => element.getAttribute('inertia') === key)\n    }\n\n    return -1\n  },\n\n  update: debounce(function (elements: Array<string>) {\n    const sourceElements = elements.map(element => this.buildDOMElement(element))\n    const targetElements = Array.from(document.head.childNodes).filter(element => this.isInertiaManagedElement(element as Element))\n\n    targetElements.forEach(targetElement => {\n      const index = this.findMatchingElementIndex((targetElement as Element), sourceElements)\n      if (index === -1) {\n        targetElement?.parentNode?.removeChild(targetElement)\n        return\n      }\n\n      const sourceElement = sourceElements.splice(index, 1)[0]\n      if (sourceElement && !targetElement.isEqualNode(sourceElement)) {\n        targetElement?.parentNode?.replaceChild(sourceElement, targetElement)\n      }\n    })\n\n    sourceElements.forEach(element => document.head.appendChild(element))\n  }, 1),\n}\n\nexport default function createHeadManager(isServer: boolean, titleCallback: ((title: string) => string), onUpdate: ((elements: string[]) => void)): ({\n  createProvider: () => ({\n    update: (elements: Array<string>) => void,\n    disconnect: () => void,\n  })\n}) {\n  const states: Record<string, Array<string>> = {}\n  let lastProviderId = 0\n\n  function connect(): string {\n    const id = (lastProviderId += 1)\n    states[id] = []\n    return id.toString()\n  }\n\n  function disconnect(id: string): void {\n    if (id === null || Object.keys(states).indexOf(id) === -1) {\n      return\n    }\n\n    delete states[id]\n    commit()\n  }\n\n  function update(id: string, elements: Array<string> = []): void {\n    if (id !== null && Object.keys(states).indexOf(id) > -1) {\n      states[id] = elements\n    }\n\n    commit()\n  }\n\n  function collect(): Array<string> {\n    const elements = Object.values(states)\n      .reduce((carry, elements) => carry.concat(elements), [])\n      .reduce((carry, element) => {\n        if (element.indexOf('<') === -1) {\n          return carry\n        }\n\n        if (element.indexOf('<title ') === 0) {\n          const title = element.match(/(<title [^>]+>)(.*?)(<\\/title>)/)\n          carry.title = title ? `${title[1]}${titleCallback(title[2])}${title[3]}`: element\n          return carry\n        }\n\n        const match = element.match(/ inertia=\"[^\"]+\"/)\n        if (match) {\n          carry[match[0]] = element\n        } else {\n          carry[Object.keys(carry).length] = element\n        }\n\n        return carry\n      }, {} as Record<string, string>)\n\n    return Object.values(elements)\n  }\n\n  function commit(): void {\n    isServer ? onUpdate(collect()) : Renderer.update(collect())\n  }\n\n  return {\n    createProvider: function () {\n      const id = connect()\n\n      return {\n        update: (elements) => update(id, elements),\n        disconnect: () => disconnect(id),\n      }\n    },\n  }\n}\n","export default function shouldIntercept(event: KeyboardEvent): boolean {\n  const isLink = (event.currentTarget as HTMLElement).tagName.toLowerCase() === 'a'\n  return !(\n    (event.target && (event?.target as HTMLElement).isContentEditable) ||\n    event.defaultPrevented ||\n    (isLink && event.which > 1) ||\n    (isLink && event.altKey) ||\n    (isLink && event.ctrlKey) ||\n    (isLink && event.metaKey) ||\n    (isLink && event.shiftKey)\n  )\n}\n","import { Router } from './router'\n\nexport * from './types'\n\nexport { default as createHeadManager } from './head'\nexport { default as shouldIntercept } from './shouldIntercept'\nexport { hrefToUrl, mergeDataIntoQueryString, urlWithoutHash } from './url'\n\nexport const Inertia = new Router()\n"],"names":["Method","modal","listener","show","html","JSON","stringify","page","document","createElement","innerHTML","querySelectorAll","forEach","a","setAttribute","this","style","position","width","height","padding","boxSizing","backgroundColor","zIndex","addEventListener","_this","hide","iframe","borderRadius","appendChild","body","prepend","overflow","contentWindow","Error","open","write","outerHTML","close","hideOnEscape","bind","removeEventListener","event","keyCode","debounce","fn","delay","timeoutID","clearTimeout","setTimeout","apply","objectToFormData","source","form","parentKey","key","FormData","Object","prototype","hasOwnProperty","call","append","composeKey","parent","value","Array","isArray","from","keys","index","toString","Date","toISOString","File","name","Blob","hrefToUrl","href","URL","window","location","mergeDataIntoQueryString","method","data","hasHost","includes","hasAbsolutePath","startsWith","hasRelativePath","hasSearch","GET","length","hasHash","url","search","qs","deepmerge","ignoreQueryPrefix","encodeValuesOnly","arrayFormat","protocol","host","pathname","substring","hash","join","urlWithoutHash","fireEvent","options","dispatchEvent","CustomEvent","fireFinishEvent","visit","detail","fireNavigateEvent","defaults","xsrfHeaderName","Router","init","resolveComponent","swapComponent","initialPage","handleInitialPageVisit","setupEventListeners","isBackForwardVisit","handleBackForwardVisit","isLocationVisit","handleLocationVisit","setPage","preserveState","handlePopstateEvent","handleScrollEvent","scrollRegions","target","hasAttribute","saveScrollPositions","replaceState","map","region","top","scrollTop","left","scrollLeft","resetScrollPositions","documentElement","getElementById","slice","scrollIntoView","restoreScrollPositions","history","state","performance","getEntriesByType","type","version","preserveScroll","then","_this2","locationVisit","sessionStorage","setItem","reload","error","getItem","parse","removeItem","rememberedState","_window$history$state2","_window$history$state4","_this3","isLocationVisitResponse","response","status","headers","isInertiaResponse","createVisitId","visitId","cancelVisit","activeVisit","cancelled","interrupted","completed","cancelToken","cancel","onCancel","onFinish","finishVisit","resolvePreserveOption","props","errors","replace","only","errorBag","forceFormData","onCancelToken","onBefore","onStart","onProgress","onSuccess","onError","hasFiles","FileList","values","some","_data","cancelable","fireBeforeEvent","Axios","CancelToken","_this4","fireStartEvent","params","token","Accept","X-Requested-With","X-Inertia","X-Inertia-Partial-Component","component","X-Inertia-Partial-Data","X-Inertia-Error-Bag","X-Inertia-Version","onUploadProgress","progress","percentage","Math","round","loaded","total","fireProgressEvent","Promise","reject","pageResponse","_window$history$state5","requestUrl","responseUrl","scopedErrors","fireErrorEvent","locationUrl","isCancel","throwException","exception","resolve","_this5","pushState","_this6","get","console","warn","post","POST","put","PUT","patch","PATCH","DELETE","remember","restore","_window$history$state6","_window$history$state7","on","callback","defaultPrevented","preventDefault","Renderer","buildDOMElement","tag","template","node","content","firstChild","script","getAttributeNames","getAttribute","isInertiaManagedElement","element","nodeType","Node","ELEMENT_NODE","findMatchingElementIndex","elements","findIndex","update","sourceElements","head","childNodes","filter","targetElement","sourceElement","splice","isEqualNode","parentNode","replaceChild","removeChild","createHeadManager","isServer","titleCallback","onUpdate","states","lastProviderId","collect","reduce","carry","concat","indexOf","title","match","commit","createProvider","id","connect","disconnect","shouldIntercept","isLink","currentTarget","tagName","toLowerCase","isContentEditable","which","altKey","ctrlKey","metaKey","shiftKey","Inertia"],"mappings":"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"}